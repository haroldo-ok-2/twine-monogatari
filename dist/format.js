window.storyFormat({
  "name": "Twison",
  "version": "0.0.1",
  "author": "Mike Lazer-Walker",
  "description": "Export your Twine 2 story as a JSON document",
  "proofing": false,
  "source": "<html>\r\n\t<head>\r\n\t\t<title>{{STORY_NAME}}</title>\r\n\r\n\t\t<link rel=\"stylesheet\" href=\"http://localhost:3000/Monogatari//engine/core/monogatari.css\">\r\n\t\t<link rel=\"stylesheet\" href=\"http://localhost:3000/Monogatari//style/main.css\">\r\n\r\n\t\t<!-- Third Party JavaScript Libraries -->\r\n\t\t<script src=\"http://localhost:3000/Monogatari//js/vendor/jquery.min.js\"></script>\r\n\r\n\t\t<!-- Monogatari JavaScript Libraries -->\r\n\t\t<script src=\"http://localhost:3000/Monogatari//engine/debug/debug.js\"></script>\r\n\t\t<script src=\"http://localhost:3000/Monogatari//engine/core/monogatari.js\"></script>\r\n\t\t\r\n\t\t<script type=\"text/javascript\">\r\n/**\r\n * Twison - Twine 2 JSON Export Story Format\r\n * \r\n * Copyright (c) 2015 Mike Walker\r\n * https://lazerwalker.com\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and\r\n * associated documentation files (the \"Software\"), to deal in the Software without restriction,\r\n * including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense,\r\n * and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so,\r\n * subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all copies or substantial\r\n * portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT\r\n * LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\r\n * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\r\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\r\n * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\r\n */\r\n\"use strict\";var Twison={extractLinksFromText:function(t){var n=t.match(/\\[\\[.+?\\]\\]/g);if(n)return n.map(function(t){var n=t.match(/\\[\\[(.*?)\\-\\&gt;(.*?)\\]\\]/);return n?{name:n[1],link:n[2]}:(t=t.substring(2,t.length-2),{name:t,link:t})}).map(function(t){var n=/(^.*?)(\\|\\?.*)?$/.exec(t.name);if(n[2]){var r=\"return \"+n[2].substring(2,n[2].length-1);console.log(\"Found conditional \",r),t.name=n[1].trimEnd(),t.condition=Twison.createJsFunction(r)}return t})},extractCommandsFromText:function(t){var n=t.split(/[\\r\\n]+/g).map(function(t){return t.replace(/\\[\\[.*?\\]\\]/g,\"\").trimEnd()}).filter(function(t){return t&&!t.startsWith(\"//\")});return Twison.processScriptingBlocks(n)},processScriptingBlocks:function(t){return t.reduce(function(t,n){return t.scriptType?n.startsWith(\"```\")?(t.commands.push(Twison.processScriptingBlock(t.scriptType,t.scriptLines)),t.scriptType=\"\",t.scriptLines.length=0):t.scriptLines.push(n):n.startsWith(\"```\")?(t.scriptType=n.slice(3).trimEnd()||\"js\",\"js\"===t.scriptType&&(t.scriptType=\"javascript\")):t.commands.push(n),t},{commands:[],scriptType:\"\",scriptLines:[]}).commands},processScriptingBlock:function(t,n){if(\"javascript\"===t)return Twison.createJsFunction(n.join(\"\\n\"));console.error(\"Unknown script type: \"+t)},htmlDecode:function(t){return(new DOMParser).parseFromString(t,\"text/html\").documentElement.textContent},createJsFunction:function(t){try{var n=Twison.htmlDecode(t),r=new Function(\"storage\",n);return function(){var t=monogatari.storage(),n=r(t);return monogatari.storage(t),n}}catch(n){console.error(\"Error while compiling JS block. \",n,{source:t})}},convertPassage:function(t){var n={text:t.innerHTML},r=Twison.extractLinksFromText(n.text);if(r&&(n.links=r),[\"name\",\"pid\",\"position\",\"tags\"].forEach(function(r){var e=t.attributes[r].value;e&&(n[r]=e)}),n.position){var e=n.position.split(\",\");n.position={x:e[0],y:e[1]}}n.tags&&(n.tags=n.tags.split(\" \"));var o=Twison.extractCommandsFromText(n.text);return o&&(n.commands=o),n},convertStory:function(t){var n=t.getElementsByTagName(\"tw-passagedata\"),r=Array.prototype.slice.call(n).map(Twison.convertPassage),e={passages:r};[\"name\",\"startnode\",\"creator\",\"creator-version\",\"ifid\"].forEach(function(n){var r=t.attributes[n].value;r&&(e[n]=r)});var o={};return e.passages.forEach(function(t){o[t.name]=t.pid}),e.passages.forEach(function(t){t.links&&t.links.forEach(function(t){t.pid=o[t.link],t.pid||(t.broken=!0)})}),e},convert:function(){var t=document.getElementsByTagName(\"tw-storydata\")[0],n=Twison.convertStory(t);return console.log(\"Parsed story\",n),n}};window.Twison=Twison;\t\t\r\n\t\t</script>\r\n\t</head>\r\n\t<body>\r\n\t\t<noscript>\r\n\t\t\t<div class=\"middle text--center\">\r\n\t\t\t\t<h2>JavaScript Disabled or not Supported.</h2>\r\n\t\t\t\t<small>To play this game, please enable JavaScript executing or use a different browser.</small>\r\n\t\t\t</div>\r\n\t\t</noscript>\r\n\t\t\r\n\t\t<pre id=\"output\" style=\"display: none;\">\r\n\t\t\r\n\t\t</pre>\r\n\t\t\r\n\t\t<div id=\"storyData\" style=\"display: none;\">\r\n\t\t\t{{STORY_DATA}}\r\n\t\t</div>\r\n\t\t\r\n\t\t<div id=\"monogatari\">\r\n\t\t\t<visual-novel>\r\n\t\t\t\t<loading-screen></loading-screen>\r\n\t\t\t\t<main-screen>\r\n\t\t\t\t\t<main-menu></main-menu>\r\n\t\t\t\t</main-screen>\r\n\t\t\t\t<game-screen>\r\n\t\t\t\t\t<dialog-log></dialog-log>\r\n\t\t\t\t\t<text-box></text-box>\r\n\t\t\t\t\t<quick-menu></quick-menu>\r\n\t\t\t\t</game-screen>\r\n\t\t\t\t<gallery-screen></gallery-screen>\r\n\t\t\t\t<load-screen></load-screen>\r\n\t\t\t\t<save-screen></save-screen>\r\n\t\t\t\t<settings-screen></settings-screen>\r\n\t\t\t\t<help-screen></help-screen>\r\n\t\t\t</visual-novel>\r\n\t\t</div>\r\n\t\t\r\n\t\t<script>\r\n\t\t\twindow.twineStory = Twison.convert();\r\n\t\t</script>\r\n\t\t<script src=\"http://localhost:3000/Monogatari//js/options.js\"></script>\r\n\t\t<script src=\"http://localhost:3000/Monogatari//js/storage-twine.js\"></script>\r\n\t\t<script src=\"http://localhost:3000/Monogatari//js/script-twine.js\"></script>\r\n\t\t<script src=\"http://localhost:3000/Monogatari//js/main.js\"></script>\r\n\t</body>\r\n</html>"
});